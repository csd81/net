Here's a **comprehensive and expanded version** of **🔐 19.1. Configure a Site-to-Site IPsec VPN**, formatted for maximum clarity and usefulness—ideal for deep learning, step-by-step instruction, training, or documentation.

---

# 🔐 19.1. Configure a Site-to-Site IPsec VPN

A **Site-to-Site IPsec VPN** creates a **secure, encrypted tunnel** between two physically separate networks—often over the internet. It allows seamless, protected communication between branch offices, data centers, or cloud networks. This section walks you through **every step of configuring a Site-to-Site IPsec VPN**, from prerequisites to verification.

---

## 🌟 1. Prerequisites for Configuration

Before starting, ensure the following prerequisites are in place at **both VPN sites**:

| **Requirement**               | **Details**                                                                 |
|------------------------------|------------------------------------------------------------------------------|
| **VPN Gateways**             | Routers or firewalls with IPsec support (e.g., Cisco, pfSense, FortiGate)   |
| **Reachable IP Addresses**   | Public or routable private IPs on the WAN interfaces of both VPN gateways   |
| **Authentication Method**    | Decide on **Pre-shared Key (PSK)** or **Digital Certificates**              |
| **Encryption & Hashing**     | Agree on algorithms (e.g., **AES-256**, **SHA-256**)                        |
| **Routing Strategy**         | Choose **Static** or **Dynamic Routing** (e.g., OSPF, BGP)                   |

---

## 🔑 2. Step-by-Step Configuration Process

### 🔹 Step 1: Configure Phase 1 – IKE (Internet Key Exchange)

**Objective**: Establish a secure channel to negotiate further IPsec parameters.

#### 1.1. Define IKEv2 Policies

```bash
crypto ikev2 policy 10
 encryption aes-cbc-256
 integrity sha256
 group 14
 prf sha256
 lifetime 86400
```

> **Explanation**:
- `aes-cbc-256` = Encryption
- `sha256` = Integrity (hashing)
- `group 14` = Diffie-Hellman group for key exchange
- `lifetime` = Key expiration period (in seconds)

#### 1.2. Authentication Using PSK

```bash
crypto ikev2 keyring MYKEYRING
 peer SITE2
  address 192.168.2.1
  pre-shared-key mysecretkey
```

> Use **digital certificates** instead for stronger, scalable authentication.

---

### 🔹 Step 2: Configure Phase 2 – IPsec

**Objective**: Negotiate the parameters for securing actual data traffic.

#### 2.1. Define the IPsec Transform Set

```bash
crypto ipsec transform-set MYSET esp-aes-256 esp-sha-hmac
```

> Defines:
- **ESP** (Encapsulating Security Payload) with AES-256 encryption
- SHA for integrity

#### 2.2. Link IPsec to IKEv2 Profile

```bash
crypto ikev2 profile VPN-PROFILE
 match identity remote address 192.168.2.1 255.255.255.255
 identity local address 192.168.1.1
 authentication remote pre-share
 authentication local pre-share
 keyring local MYKEYRING
```

---

### 🔹 Step 3: Define the Tunnel Interface

**Objective**: Create a virtual interface to carry encrypted traffic.

#### 3.1. Configure Tunnel Parameters

```bash
interface Tunnel0
 ip address 10.0.0.1 255.255.255.252
 tunnel source 192.168.1.1
 tunnel destination 192.168.2.1
```

> Choose an unused private subnet for the tunnel IP.

#### 3.2. Apply the Crypto Map

```bash
crypto map MYMAP 10 ipsec-isakmp
 set peer 192.168.2.1
 set transform-set MYSET
 match address VPN_ACL
```

> The `VPN_ACL` defines which traffic should pass through the tunnel.

---

### 🔹 Step 4: Configure Routing Between Sites

**Goal**: Ensure traffic knows to use the tunnel for remote destinations.

#### 4.1. Static Routing Example

```bash
ip route 192.168.2.0 255.255.255.0 Tunnel0
```

#### 4.2. Dynamic Routing Example (OSPF)

```bash
router ospf 1
 network 192.168.0.0 0.0.255.255 area 0
```

> Use dynamic routing if you expect changes in the network or have multiple sites.

---

### 🔹 Step 5: Testing and Verification

#### 5.1. Check VPN Tunnel Status

```bash
show crypto ikev2 sa
show crypto ipsec sa
```

> Confirms the tunnel is **up** and actively securing traffic.

#### 5.2. Test Cross-Site Connectivity

```bash
ping 192.168.2.1 source 192.168.1.1
```

> You can also test access to shared folders, RDP, or web apps between sites.

---

## ✅ 6. Troubleshooting Tips

| **Issue**                         | **Check**                                                                 |
|----------------------------------|--------------------------------------------------------------------------|
| Tunnel not establishing          | Confirm matching encryption/authentication on both ends                  |
| Authentication fails             | Ensure PSKs match or certificates are valid                              |
| No traffic between networks      | Check routing tables, ACLs, and NAT rules                                |
| Unexpected tunnel drops          | Review logs (`show log`) and lifetime settings                          |
| VPN ACL misconfiguration         | Ensure only the correct traffic is selected for encryption               |

> Use `debug crypto isakmp`, `debug crypto ipsec`, or system logs as needed for real-time analysis.

---

## 🚀 7. Final Thoughts

Implementing a **Site-to-Site IPsec VPN** provides secure, scalable, and cost-effective interconnectivity between remote networks. Following this structured configuration process ensures:
- **Data confidentiality** and **integrity**
- **Seamless communication** across geographically separated locations
- A **strong security posture** without the costs of private leased lines

By carefully defining IKE and IPsec settings, creating tunnel interfaces, and properly routing traffic, you can deploy a **robust and reliable Site-to-Site VPN** for your organization.

---

Would you like:
- A **visual diagram** of this configuration?
- A **PDF cheat sheet**?
- A **lab topology with configuration files** to practice in Packet Tracer or GNS3?

Just let me know!